<!DOCTYPE html>
<html lang="en">
{{HEADER}}
<body>
    <div class="container">
        {{NAV}}

        <form id="config-form">
            <!-- Hello World and Sample Settings (2-column on desktop) -->
            <div class="grid-2col">
            <!-- MQTT Topics Section -->
            <section class="section">
                <h2>üìä MQTT Topics</h2>
                <div class="form-group">
                    <label for="mqtt_topic_solar">Solar Power Topic</label>
                    <input type="text" id="mqtt_topic_solar" name="mqtt_topic_solar" maxlength="127" placeholder="e.g. home/solar/power">
                    <small>MQTT topic for solar power readings (in kW)</small>
                </div>
                <div class="form-group">
                    <label for="mqtt_topic_grid">Grid Power Topic</label>
                    <input type="text" id="mqtt_topic_grid" name="mqtt_topic_grid" maxlength="127" placeholder="e.g. home/grid/power">
                    <small>MQTT topic for grid power readings (JSON with 'value' field in kW)</small>
                </div>
            </section>

            <!-- Sample Settings Section -->
            <section class="section">
                <h2>‚öôÔ∏è Sample Settings</h2>
                <div class="form-group">
                    <label for="dummy_setting">Dummy Setting</label>
                    <input type="text" id="dummy_setting" name="dummy_setting" maxlength="63">
                    <small>Example setting for demonstration</small>
                </div>
            </section>
            </div>

            <!-- Display Settings Section -->
            <section class="section">
                <h2>üîÜ Display Settings</h2>
                <div class="form-group">
                    <label for="lcd_brightness">LCD Brightness: <span id="lcd_brightness_value">100</span>%</label>
                    <input type="range" id="lcd_brightness" name="lcd_brightness" min="0" max="100" value="100" step="1" style="width: 100%;">
                    <small>Adjust LCD backlight brightness (0% = off, 100% = maximum)</small>
                </div>
            </section>

            <!-- Power Threshold Configuration Section -->
            <section class="section">
                <h2>‚ö° Power Thresholds</h2>
                <p class="section-description">Configure thresholds (T<sub>0</sub>, T<sub>1</sub>, T<sub>2</sub>) that define color zones for power displays. Each threshold value creates a boundary between zones. The colored dots below show which color appears in each zone.</p>
                
                <!-- Grid Power Thresholds -->
                <div class="form-group">
                    <label>Grid Power (kW)</label>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- Top line: Input boxes -->
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label style="font-size: 13px; color: #666; font-weight: 600; min-width: 25px;">T<sub>0</sub>:</label>
                                <input type="number" id="grid_threshold_0" name="grid_threshold_0" step="0.1" min="-10.0" max="10.0" value="0.0" style="width: 80px; padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 500;">
                                <span style="font-size: 12px; color: #888; font-weight: 500;">kW</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label style="font-size: 13px; color: #666; font-weight: 600; min-width: 25px;">T<sub>1</sub>:</label>
                                <input type="number" id="grid_threshold_1" name="grid_threshold_1" step="0.1" min="-10.0" max="10.0" value="0.5" style="width: 80px; padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 500;">
                                <span style="font-size: 12px; color: #888; font-weight: 500;">kW</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label style="font-size: 13px; color: #666; font-weight: 600; min-width: 25px;">T<sub>2</sub>:</label>
                                <input type="number" id="grid_threshold_2" name="grid_threshold_2" step="0.1" min="-10.0" max="10.0" value="2.5" style="width: 80px; padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 500;">
                                <span style="font-size: 12px; color: #888; font-weight: 500;">kW</span>
                            </div>
                        </div>
                        <!-- Bottom line: Visual representation -->
                        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; background: #f9f9f9; border-radius: 6px; padding: 12px 15px;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="grid-dot-0"></span>
                                <span id="grid-range-0" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">&lt; 0 kW</span>
                            </div>
                            <span style="color: #bbb; font-size: 16px; margin: 0 4px; font-weight: bold;">‚Üí</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="grid-dot-1"></span>
                                <span id="grid-range-1" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">0‚Äì0.5 kW</span>
                            </div>
                            <span style="color: #bbb; font-size: 16px; margin: 0 4px; font-weight: bold;">‚Üí</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="grid-dot-2"></span>
                                <span id="grid-range-2" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">0.5‚Äì2.5 kW</span>
                            </div>
                            <span style="color: #bbb; font-size: 16px; margin: 0 4px; font-weight: bold;">‚Üí</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="grid-dot-3"></span>
                                <span id="grid-range-3" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">‚â• 2.5 kW</span>
                            </div>
                        </div>
                    </div>
                    <small>Grid supports negative values (export). T<sub>0</sub> ‚â§ T<sub>1</sub> ‚â§ T<sub>2</sub> required.</small>
                </div>

                <!-- Home Power Thresholds -->
                <div class="form-group">
                    <label>Home Consumption (kW)</label>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- Top line: Input boxes -->
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label style="font-size: 13px; color: #666; font-weight: 600; min-width: 25px;">T<sub>0</sub>:</label>
                                <input type="number" id="home_threshold_0" name="home_threshold_0" step="0.1" min="0.0" max="10.0" value="0.5" style="width: 80px; padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 500;">
                                <span style="font-size: 12px; color: #888; font-weight: 500;">kW</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label style="font-size: 13px; color: #666; font-weight: 600; min-width: 25px;">T<sub>1</sub>:</label>
                                <input type="number" id="home_threshold_1" name="home_threshold_1" step="0.1" min="0.0" max="10.0" value="1.0" style="width: 80px; padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 500;">
                                <span style="font-size: 12px; color: #888; font-weight: 500;">kW</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label style="font-size: 13px; color: #666; font-weight: 600; min-width: 25px;">T<sub>2</sub>:</label>
                                <input type="number" id="home_threshold_2" name="home_threshold_2" step="0.1" min="0.0" max="10.0" value="2.0" style="width: 80px; padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 500;">
                                <span style="font-size: 12px; color: #888; font-weight: 500;">kW</span>
                            </div>
                        </div>
                        <!-- Bottom line: Visual representation -->
                        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; background: #f9f9f9; border-radius: 6px; padding: 12px 15px;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="home-dot-0"></span>
                                <span id="home-range-0" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">&lt; 0.5 kW</span>
                            </div>
                            <span style="color: #bbb; font-size: 16px; margin: 0 4px; font-weight: bold;">‚Üí</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="home-dot-1"></span>
                                <span id="home-range-1" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">0.5‚Äì1.0 kW</span>
                            </div>
                            <span style="color: #bbb; font-size: 16px; margin: 0 4px; font-weight: bold;">‚Üí</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="home-dot-2"></span>
                                <span id="home-range-2" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">1.0‚Äì2.0 kW</span>
                            </div>
                            <span style="color: #bbb; font-size: 16px; margin: 0 4px; font-weight: bold;">‚Üí</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="home-dot-3"></span>
                                <span id="home-range-3" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">‚â• 2.0 kW</span>
                            </div>
                        </div>
                    </div>
                    <small>Home must be non-negative. T<sub>0</sub> ‚â§ T<sub>1</sub> ‚â§ T<sub>2</sub> required.</small>
                </div>

                <!-- Solar Power Thresholds -->
                <div class="form-group">
                    <label>Solar Generation (kW)</label>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- Top line: Input boxes -->
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label style="font-size: 13px; color: #666; font-weight: 600; min-width: 25px;">T<sub>0</sub>:</label>
                                <input type="number" id="solar_threshold_0" name="solar_threshold_0" step="0.1" min="0.0" max="10.0" value="0.5" style="width: 80px; padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 500;">
                                <span style="font-size: 12px; color: #888; font-weight: 500;">kW</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label style="font-size: 13px; color: #666; font-weight: 600; min-width: 25px;">T<sub>1</sub>:</label>
                                <input type="number" id="solar_threshold_1" name="solar_threshold_1" step="0.1" min="0.0" max="10.0" value="1.5" style="width: 80px; padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 500;">
                                <span style="font-size: 12px; color: #888; font-weight: 500;">kW</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <label style="font-size: 13px; color: #666; font-weight: 600; min-width: 25px;">T<sub>2</sub>:</label>
                                <input type="number" id="solar_threshold_2" name="solar_threshold_2" step="0.1" min="0.0" max="10.0" value="3.0" style="width: 80px; padding: 6px 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 500;">
                                <span style="font-size: 12px; color: #888; font-weight: 500;">kW</span>
                            </div>
                        </div>
                        <!-- Bottom line: Visual representation -->
                        <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; background: #f9f9f9; border-radius: 6px; padding: 12px 15px;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="solar-dot-0"></span>
                                <span id="solar-range-0" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">&lt; 0.5 kW</span>
                            </div>
                            <span style="color: #bbb; font-size: 16px; margin: 0 4px; font-weight: bold;">‚Üí</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="solar-dot-1"></span>
                                <span id="solar-range-1" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">0.5‚Äì1.5 kW</span>
                            </div>
                            <span style="color: #bbb; font-size: 16px; margin: 0 4px; font-weight: bold;">‚Üí</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="solar-dot-2"></span>
                                <span id="solar-range-2" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">1.5‚Äì3.0 kW</span>
                            </div>
                            <span style="color: #bbb; font-size: 16px; margin: 0 4px; font-weight: bold;">‚Üí</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span class="color-dot" id="solar-dot-3"></span>
                                <span id="solar-range-3" style="font-size: 13px; color: #444; white-space: nowrap; font-family: 'Courier New', monospace; font-weight: 500;">‚â• 3.0 kW</span>
                            </div>
                        </div>
                    </div>
                    <small>Solar must be non-negative. T<sub>0</sub> ‚â§ T<sub>1</sub> ‚â§ T<sub>2</sub> required.</small>
                </div>
            </section>

            <!-- Color Configuration Section -->
            <section class="section">
                <h2>üé® Color Configuration</h2>
                <p class="section-description">Configure colors for the 4 power zones. Colors apply globally across all power types.</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="form-group">
                        <label for="color_good">Good Zone Color</label>
                        <input type="color" id="color_good" name="color_good" value="#00FF00" style="width: 100%; height: 50px; cursor: pointer;">
                        <small>Value &lt; T0 (default: green)</small>
                    </div>
                    <div class="form-group">
                        <label for="color_ok">OK Zone Color</label>
                        <input type="color" id="color_ok" name="color_ok" value="#FFFFFF" style="width: 100%; height: 50px; cursor: pointer;">
                        <small>T0 ‚â§ value &lt; T1 (default: white)</small>
                    </div>
                    <div class="form-group">
                        <label for="color_attention">Attention Zone Color</label>
                        <input type="color" id="color_attention" name="color_attention" value="#FFA500" style="width: 100%; height: 50px; cursor: pointer;">
                        <small>T1 ‚â§ value &lt; T2 (default: orange)</small>
                    </div>
                    <div class="form-group">
                        <label for="color_warning">Warning Zone Color</label>
                        <input type="color" id="color_warning" name="color_warning" value="#FF0000" style="width: 100%; height: 50px; cursor: pointer;">
                        <small>value ‚â• T2 (default: red)</small>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <button type="button" id="restore-defaults-btn" class="btn btn-secondary" style="width: 100%;">
                        üîÑ Restore Factory Defaults
                    </button>
                    <small>Reset all thresholds and colors to factory defaults</small>
                </div>
            </section>

            {{FOOTER}}
        </form>
    </div>

    <!-- Floating Health Widget Overlay (Expanded View) -->
    <div style="position: fixed; top: 24px; right: 24px; z-index: 1000;">
        <div class="health-widget-expanded" id="health-expanded" style="display:none;">
            <div class="health-header">
                <div class="health-status-dot" id="health-status-dot-expanded"></div>
                <span>Device Health</span>
                <button id="health-close" class="health-close-btn">‚úï</button>
            </div>
            <div class="health-stats">
                <!-- System -->
                <div class="health-stat">
                    <span class="health-label">Uptime</span>
                    <span class="health-value" id="health-uptime">--</span>
                </div>
                <div class="health-stat">
                    <span class="health-label">Reset Reason</span>
                    <span class="health-value" id="health-reset">--</span>
                </div>
                <!-- CPU -->
                <div class="health-stat">
                    <span class="health-label">CPU Usage</span>
                    <span class="health-value" id="health-cpu-full">--</span>
                </div>
                <div class="health-stat">
                    <span class="health-label">Core Temp</span>
                    <span class="health-value" id="health-temp">--</span>
                </div>
                <!-- Memory -->
                <div class="health-stat">
                    <span class="health-label">Free Heap</span>
                    <span class="health-value" id="health-heap">--</span>
                </div>
                <div class="health-stat">
                    <span class="health-label">Min Free Heap</span>
                    <span class="health-value" id="health-heap-min">--</span>
                </div>
                <div class="health-stat">
                    <span class="health-label">Heap Fragmentation</span>
                    <span class="health-value" id="health-heap-frag">--</span>
                </div>
                <!-- Storage -->
                <div class="health-stat">
                    <span class="health-label">Flash Usage</span>
                    <span class="health-value" id="health-flash">--</span>
                </div>
                <!-- Network -->
                <div class="health-stat">
                    <span class="health-label">WiFi RSSI</span>
                    <span class="health-value" id="health-rssi">--</span>
                </div>
                <div class="health-stat">
                    <span class="health-label">IP Address</span>
                    <span class="health-value" id="health-ip">--</span>
                </div>
            </div>
        </div>
    </div>

    <div id="reboot-overlay" class="reboot-overlay" style="display:none;">
        <div class="reboot-modal">
            <div id="reboot-spinner" class="spinner"></div>
            <h2 id="reboot-title">Device Rebooting</h2>
            <p id="reboot-message">Please wait while the device restarts...</p>
            <div id="reboot-progress-container" style="margin: 25px 0; display: none;">
                <div class="progress-bar" style="height: 30px; background: #e0e0e0; border-radius: 15px; overflow: hidden;">
                    <div id="reboot-progress-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s;"></div>
                </div>
                <div id="reboot-progress-text" style="margin-top: 10px; font-size: 18px; font-weight: 600; color: #667eea;">0%</div>
            </div>
            <p id="reboot-submessage" class="small">This page will automatically refresh when ready</p>
            <div id="reconnect-status" class="reconnect-status"></div>
        </div>
    </div>

    <script src="/portal.js"></script>
</body>
</html>
